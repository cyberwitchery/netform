# heavy example

this walkthrough uses a realistic, noisy config pair and shows how to get:
- human report (`report.md` style output to stdout)
- machine diff (`diff.json`)
- machine plan (`plan.json`)

## intended (`intended.cfg`)

```text
! site: den-edge-1
version 17.9
service timestamps debug datetime msec
service timestamps log datetime msec
hostname den-edge-1
ip domain name example.net
!
ntp server 10.10.10.10 prefer
ntp server 10.10.10.11
!
ip prefix-list PL-EDGE-OUT seq 10 permit 10.10.0.0/16 le 24
ip prefix-list PL-EDGE-OUT seq 20 permit 10.20.0.0/16 le 24
!
route-map RM-EDGE-OUT permit 10
  match ip address prefix-list PL-EDGE-OUT
  set community 65000:100 additive
!
router bgp 65000
  bgp log-neighbor-changes
  neighbor 192.0.2.1 remote-as 65100
  neighbor 192.0.2.1 description core-a
  neighbor 192.0.2.1 route-map RM-EDGE-OUT out
  address-family ipv4 unicast
    network 10.10.1.0 mask 255.255.255.0
    network 10.20.1.0 mask 255.255.255.0
    neighbor 192.0.2.1 activate
!
interface Loopback0
  description router-id
  ip address 10.255.255.1 255.255.255.255
!
interface GigabitEthernet0/0
  description uplink-core-a
  ip address 192.0.2.2 255.255.255.252
  no shutdown
!
interface GigabitEthernet0/1
  description server-lan
  ip address 10.10.1.1 255.255.255.0
  ip access-group ACL-SERVER-LAN in
  no shutdown
!
ip access-list extended ACL-SERVER-LAN
  permit tcp 10.10.1.0 0.0.0.255 any eq 443
  permit tcp 10.10.1.0 0.0.0.255 any eq 22
  deny ip any any log
!
line vty 0 4
  transport input ssh
  login local
!
end
```

## actual (`actual.cfg`)

```text
! generated by backup job
version 17.9
service timestamps debug datetime msec
service timestamps log datetime msec
hostname den-edge-1
ip domain name example.net
!
ntp server 10.10.10.11
ntp server 10.10.10.10 prefer
!
ip prefix-list PL-EDGE-OUT seq 10 permit 10.10.0.0/16 le 24
ip prefix-list PL-EDGE-OUT seq 20 permit 10.30.0.0/16 le 24
!
route-map RM-EDGE-OUT permit 10
  set community 65000:100 additive
  match ip address prefix-list PL-EDGE-OUT
!
router bgp 65000
  bgp log-neighbor-changes
  neighbor 192.0.2.1 remote-as 65100
  neighbor 192.0.2.1 description core-a
  address-family ipv4 unicast
    network 10.10.1.0 mask 255.255.255.0
    neighbor 192.0.2.1 activate
!
interface Loopback0
  description router-id
  ip address 10.255.255.1 255.255.255.255
!
interface GigabitEthernet0/0
  description uplink-core-a
  ip address 192.0.2.2 255.255.255.252
  shutdown
!
interface GigabitEthernet0/1
  description server-lan
  ip address 10.10.1.1 255.255.255.0
  ip access-group ACL-SERVER-LAN in
  no shutdown
!
ip access-list extended ACL-SERVER-LAN
  permit tcp 10.10.1.0 0.0.0.255 any eq 22
  permit tcp 10.10.1.0 0.0.0.255 any eq 443
  deny ip any any log
!
line vty 0 4
  transport input ssh
  login local
!
end
```

## run diff

```bash
config-diff \
  --dialect iosxe \
  --order-policy keyed-stable \
  --ignore-comments \
  intended.cfg actual.cfg
```

for machine output:

```bash
config-diff --dialect iosxe --order-policy keyed-stable --ignore-comments --json intended.cfg actual.cfg > diff.json
config-diff --dialect iosxe --order-policy keyed-stable --ignore-comments --plan-json intended.cfg actual.cfg > plan.json
```

direction note:
- `config-diff intended actual` describes drift from intended -> actual.
- for remediation-oriented plans ("what to change on actual to reach intended"), run `config-diff actual intended --plan-json`.

## expected behavior

- comment drift is ignored (`! generated by backup job`)
- child reordering under blocks is tolerated with `keyed-stable` (for example ntp order, acl permit order, route-map sub-lines)
- semantic changes still show up:
  - prefix-list `10.20.0.0/16` vs `10.30.0.0/16`
  - missing bgp `route-map ... out`
  - missing bgp network `10.20.1.0/24`
  - interface `no shutdown` vs `shutdown`

## sample report excerpt

```text
# Config Diff Report

## Stats
- Inserts: 0 (0 lines)
- Deletes: 0 (0 lines)
- Replaces: 3 (3 -> 3 lines)
```

## sample `diff.json` excerpt

```json
{
  "has_changes": true,
  "edits": [
    { "type": "Replace", "old_lines": [{ "text": "  no shutdown" }], "new_lines": [{ "text": "  shutdown" }] }
  ],
  "findings": []
}
```

## sample `plan.json` excerpt

```json
{
  "version": "v1",
  "actions": [
    {
      "type": "apply_line_edits_under_context",
      "context_path": [7],
      "line_edits": [{ "kind": "replace", "text": "  shutdown" }]
    }
  ],
  "findings": []
}
```
